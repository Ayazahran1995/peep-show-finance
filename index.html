<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Learn about finance terms with a humorous and relatable twist">
    <meta name="theme-color" content="#3533cd">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="PPNeueMachina-Regular.otf" as="font" type="font/otf" crossorigin>
    <link rel="preload" href="PPNeueMachina-Bold.otf" as="font" type="font/otf" crossorigin>
    
    <title>üí∏ Finance Explained, But With More Despair</title>
    
    <style>
        /* Fallback font stack */
        body {
            font-family: 'Neue Machina', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        /* Existing font-face declarations */
        @font-face {
            font-family: 'Neue Machina';
            src: url('PPNeueMachina-Regular.otf') format('opentype');
            font-display: swap;
        }

        @font-face {
            font-family: 'Neue Machina Bold';
            src: url('PPNeueMachina-Bold.otf') format('opentype');
            font-display: swap;
        }
        <!-- Add this to your HTML -->
<div class="journey-map">
    <div class="journey-steps">
        <div class="step" data-term="Savings Account">üí∞</div>
        <div class="step" data-term="Investing">üìà</div>
        <div class="step" data-term="Crypto">ü™ô</div>
        <div class="step" data-term="Mortgage">üè†</div>
        <div class="step" data-term="Pension">üë¥</div>
    </div>
</div>

<style>
.journey-map {
    margin: 20px;
    padding: 20px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 15px;
    backdrop-filter: blur(10px);
}

.journey-steps {
    display: flex;
    justify-content: space-between;
    position: relative;
}

.journey-steps::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px;
    background: rgba(255, 255, 255, 0.2);
    z-index: 1;
}

.step {
    width: 50px;
    height: 50px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    z-index: 2;
}

.step:hover {
    transform: scale(1.1);
    background: rgba(255, 255, 255, 0.2);
}

.step.completed {
    background: #4CAF50;
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

        /* Existing styles remain the same until .cta-buttons */
        
        .cta-buttons button {
            background: transparent;
            border: 2px solid white;
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 4vw;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-width: 200px;
        }

        .cta-buttons button:hover { 
            background: white; 
            color: black; 
            transform: translateY(-2px);
        }

        .cta-buttons button:active {
            transform: translateY(0);
        }

        .cta-buttons button.loading {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .cta-buttons button:focus {
            outline: 2px solid #fff;
            outline-offset: 2px;
        }

        /* Loading spinner */
        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
        }

        @keyframes spin {
            0% { transform: translateY(-50%) rotate(0deg); }
            100% { transform: translateY(-50%) rotate(360deg); }
        }

        /* Accessibility improvements */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        /* High contrast mode support */
        @media (forced-colors: active) {
            .term-container {
                border: 2px solid CanvasText;
            }
            
            .cta-buttons button {
                border: 2px solid CanvasText;
            }
        }

        /* Reduced motion preference */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
    </style>
</head>
<body>
    <main>
        <h1>üí∏ Finance Explained, But With More Despair</h1>

        <div class="journey-map">
    <div class="journey-steps">
        <div class="step" data-term="Savings Account">üí∞</div>
        <div class="step" data-term="Investing">üìà</div>
        <div class="step" data-term="Crypto">ü™ô</div>
        <div class="step" data-term="Mortgage">üè†</div>
        <div class="step" data-term="Pension">üë¥</div>
    </div>
        </div>
        <div class="term-container" id="term-container" role="region" aria-live="polite">
            <div class="term-emoji" id="term-emoji" aria-hidden="true">üí∏</div>
            <div class="term" id="term">Loading misery...</div>
            <div class="explanation" id="explanation">Please hold. Doom is buffering.</div>
            <div class="scenario" id="scenario">*Awkward scenario loading...*</div>
        </div>

        <div id="doom-counter" role="status">Doom Level: <span id="doom-count">0</span> - <span id="doom-message">Welcome to Despair.</span></div>
        <div id="progress" role="status">Seen <span id="seen-count">0</span>/<span id="total-terms">12</span> terms. Keep going!</div>
        <div id="achievements" role="status">Achievements: <span id="achievement-list">None yet. Keep clicking.</span></div>

        <div class="cta-buttons">
            <button id="generate-btn" onclick="generateTerm()" aria-label="Generate new finance term">
                Make It Worse
                <span class="loading-spinner" aria-hidden="true"></span>
            </button>
        </div>
    </main>

    <script>
        // Existing financeTerms, scenarios, doomMessages, and achievements arrays remain the same

        let termsQueue = [...financeTerms];
        let doomCount = 0;
        let seenCount = 0;
        let unlockedAchievements = [];
        let buttonLocked = false;

        // Add keyboard navigation support
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'Enter') {
                e.preventDefault();
                generateTerm();
            }
        });

        async function generateTerm() {
            if (buttonLocked) return;
            
            const button = document.getElementById('generate-btn');
            const spinner = button.querySelector('.loading-spinner');
            
            buttonLocked = true;
            button.classList.add('loading');
            spinner.style.display = 'block';
            button.setAttribute('aria-busy', 'true');

            try {
                if (termsQueue.length === 0) {
                    termsQueue = [...financeTerms];
                }

                const randomIndex = Math.floor(Math.random() * termsQueue.length);
                const termData = termsQueue.splice(randomIndex, 1)[0];

                // Update content with animation
                const container = document.getElementById("term-container");
                container.style.animation = "none";
                void container.offsetWidth;
                container.style.animation = "fadeIn 0.8s ease";

                // Update content
                document.getElementById("term").textContent = termData.term;
                document.getElementById("explanation").textContent = termData.explanation;
                document.getElementById("scenario").textContent = scenarios[termData.term] || "No scenario found, but life is still tough.";
                document.getElementById("term-emoji").textContent = termData.emoji;

                // Update counters and achievements
                doomCount++;
                seenCount++;
                updateDoomCounter();
                updateProgress();
                checkAchievements();

                // Add to history for browser back/forward
                history.pushState({ term: termData.term }, '', '#');
            } catch (error) {
                console.error('Error generating term:', error);
                alert('Something went wrong. Please try again.');
            } finally {
                // Reset button state
                setTimeout(() => {
                    buttonLocked = false;
                    button.classList.remove('loading');
                    spinner.style.display = 'none';
                    button.setAttribute('aria-busy', 'false');
                }, 500);
            }
        }

        // Existing updateDoomCounter, updateProgress, checkAchievements, and updateAchievements functions remain the same

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            generateTerm();
            
            // Add service worker registration
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js').catch(console.error);
            }
        });
    </script>
</body>
</html>
